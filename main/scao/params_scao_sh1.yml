---

main:
  root_dir:          './calib/SCAO'         # Root directory for calibration manager
  pixel_pupil:       160                    # Linear dimension of pupil phase array
  pixel_pitch:       0.05                   # [m] Pitch of the pupil phase array
  total_time:        0.050                  # [s] Total simulation running time
  time_step:         0.001                  # [s] Simulation time step

data_comm:
  class:             'DataComm'
  comm_port_in:         '0:9000'
  comm_port_out:        '8000'
  outputs_origin_proc: [0]
  items_to_receive: ['out_on_axis_source_ef']
  inputs:    
    input_list: ['res_surf-dm.out_layer']
  outputs:    ['out_on_axis_source_ef']

sh:
  class:             'SH'
  subap_wanted_fov:  1.2                     # Requested field-of-view [arcsec]
  sensor_pxscale:    0.15                     # Pixel scale in arcsec/pix
  subap_npx:         6                       # Output sampling [usually corresponding to CCD pixels]
  subap_on_diameter: 20                      # Number of subapertures in diameter
  wavelengthInNm:    750                     # [nm] Pyramid wavelength
  convolGaussSpotSize: 0
  inputs:
    in_ef: 'data_comm.out_on_axis_source_ef:-1'
  outputs:  ['out_i']

detector:
  class:             'CCD'
  size:              [120,120]                 # Detector size in pixels
  dt:                0.001                   # [s] Detector integration time
  bandw:             300                     # [nm] Sensor bandwidth
  photon_noise:      True                    # activate photon noise
  readout_noise:     True                    # activate readout noise
  readout_level:     1.0                     # readout noise in [e-/pix/frame]
  quantum_eff:       0.32                    # quantum efficiency * total transmission
  inputs:
    in_i: 'sh.out_i'
  outputs:  ['out_pixels']

slopec:
  class:             'ShSlopec'
  subapdata_object:  'scao_subaps_n20_th0.5'  # tag of the pyramid WFS pupils
  sn_object:         'scao_sn'                # tag of the slope reference vector
  inputs:
    in_pixels:        'detector.out_pixels'
  outputs:  ['out_slopes', 'out_subapdata']

rec:
  class:              'Modalrec'
  recmat_object:      'scao_sh_rec5'         # reconstruction matrix tag
  inputs:
    in_slopes:        'slopec.out_slopes'
  outputs:  ['out_modes', 'out_pseudo_ol_modes', 'out_modes_first_step']

control:
  class:             'IntControl'
  delay:             2                      # Total temporal delay in time steps
  int_gain:          [0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5, # Integrator gain (for 'INT' control)
                      0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
                      0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
                      0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
                      0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
                      0.5,0.5,0.5,0.5]  
  inputs:
      delta_comm: 'rec.out_modes'     
  outputs:  ['out_comm']

dm:
  class:             'DM'
  type_str:          'zernike'              # modes type
  nmodes:            54                     # number of modes
  npixels:           160                    # linear dimension of DM phase array
  obsratio:          0.1                    # obstruction dimension ratio w.r.t. diameter
  height:            0                      # DM height [m]
  inputs:
      in_command: 'control.out_comm'
  outputs:  ['out_layer']

psf:
  class:             'PSF'
  wavelengthInNm:    1650                 # [nm] Imaging wavelength
  nd:                8                    # padding coefficient for PSF computation
  start_time:        0.05                # PSF integration start time
  inputs:
      in_ef:  'data_comm.out_on_axis_source_ef'
  outputs:  ['out_psf', 'out_sr']

#data_store:
#  class:             'DataStore'
#  store_dir:         './output'             # Data result directory: 'store_dir'/TN/
#  inputs:    
#    input_list: ['res_ef-data_comm.out_on_axis_source_ef']

sc_disp:
  class:            'SlopecDisplay'
  inputs:
  inputs:
    slopes:       'slopec.out_slopes'
    subapdata:    'slopec.out_subapdata'
    pixels:       'detector.out_pixels'
  disp_factor:      4

sr_disp:
  class:            'PlotDisplay'
  inputs:
    value:       'psf.out_sr'
  window:           11
  title:            'SR'

dm_disp:
  class:            'PhaseDisplay'
  inputs:
    phase:       "dm.out_layer"
  window:           13
  title:            'DM'
  disp_factor:      2

psf_disp:
  class:            'PsfDisplay'
  inputs:
    psf:       "psf.out_psf"
  window:           14
  title:            'PSF'
  disp_factor:      2

cmd_disp:
  class:            'ModesDisplay'
  inputs:
    modes:       "rec.out_modes"
  window:           16
  title:            'rec.out_modes'
  disp_factor:      2
